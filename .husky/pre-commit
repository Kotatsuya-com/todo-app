echo "ğŸ” Running enhanced pre-commit quality checks..."
echo "ğŸš¨ Following mandatory implementation rules from CLAUDE.md"

# Phase 1: Auto-fix what we can
echo "ğŸ“ Phase 1: Auto-fixing lint issues..."
npm run lint:fix

# Phase 2: Lint validation
echo "âš¡ Phase 2: Running lint check..."
if ! npm run lint; then
  echo "âŒ ESLint found issues that could not be auto-fixed."
  echo "ğŸ’¡ Please review the errors above and fix them manually."
  echo "ğŸ”§ You can run 'npm run lint:fix' to auto-fix some issues."
  exit 1
fi

# Phase 3: TypeScript type safety (comprehensive)
echo "ğŸ” Phase 3: Running comprehensive TypeScript checks..."
if ! npm run type-check:ci; then
  echo "âŒ TypeScript found type errors."
  echo "ğŸ’¡ Common fixes based on CLAUDE.md:"
  echo "   - Use 'new EntityName(data)' instead of plain objects"
  echo "   - Add explicit type annotations: 'let variable: Type | null = null'"
  echo "   - Ensure function signatures have all required parameters"
  exit 1
fi

# Phase 4: Quick test validation (fail-fast)
echo "ğŸ§ª Phase 4: Running quick test validation..."
if ! npm run test:quick; then
  echo "âŒ Tests failed during pre-commit validation."
  echo "ğŸ’¡ Common test fixes based on CLAUDE.md:"
  echo "   - Use 'waitFor' for optimistic updates"
  echo "   - Use range expectations for concurrent operations"
  echo "   - Verify mock data consistency with actual state"
  echo "   - Manual calculation verification for loops"
  exit 1
fi

# Phase 5: Build validation
echo "ğŸ—ï¸  Phase 5: Validating production build..."
if ! npm run build; then
  echo "âŒ Production build failed."
  echo "ğŸ’¡ Fix build errors before committing."
  exit 1
fi

echo "âœ… All enhanced quality checks passed!"
echo "ğŸ‰ Code follows mandatory implementation rules and quality standards."
